{% extends 'base.html' %}

{% block title %}Send Notifications - {{ site_name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h1 class="h3 mb-0">Send System Notification</h1>
                </div>
                <div class="card-body p-4">
                    <div class="alert alert-info mb-4">
                        <i class="bi bi-info-circle-fill"></i>
                        Use this form to send notifications to users. Notifications will appear in their dashboard and notification center.
                    </div>
                    
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="title" class="form-label">Notification Title</label>
                            <input type="text" class="form-control" id="title" name="title" required maxlength="255">
                        </div>
                        
                        <div class="mb-3">
                            <label for="message" class="form-label">Message</label>
                            <textarea class="form-control" id="message" name="message" rows="5" required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notification_type" class="form-label">Notification Type</label>
                            <select class="form-select" id="notification_type" name="notification_type">
                                <option value="">General</option>
                                {% for type_value, type_display in notification_types %}
                                    <option value="{{ type_value }}">{{ type_display }}</option>
                                {% endfor %}
                            </select>
                            <div class="form-text">
                                The notification type determines how it's categorized and displayed to users.
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="recipient_type" class="form-label">Recipients</label>
                            <select class="form-select" id="recipient_type" name="recipient_type" required onchange="toggleCourseSelect()">
                                <option value="">Select Recipients</option>
                                <option value="all">All Users</option>
                                <option value="students">All Students</option>
                                <option value="teachers">All Teachers</option>
                                <option value="course">Students in a Specific Course</option>
                            </select>
                        </div>
                        
                        <div class="mb-3" id="course-select-container" style="display: none;">
                            <label for="course_id" class="form-label">Select Course</label>
                            <select class="form-select" id="course_id" name="course_id">
                                <option value="">Select a Course</option>
                                {% for course in courses %}
                                    <option value="{{ course.id }}">{{ course.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'core:admin:dashboard' %}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-send"></i> Send Notification
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    function toggleCourseSelect() {
        const recipientType = document.getElementById('recipient_type').value;
        const courseContainer = document.getElementById('course-select-container');
        
        if (recipientType === 'course') {
            courseContainer.style.display = 'block';
            document.getElementById('course_id').setAttribute('required', 'required');
        } else {
            courseContainer.style.display = 'none';
            document.getElementById('course_id').removeAttribute('required');
        }
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        toggleCourseSelect();
    });
</script>
{% endblock %}
{% endblock %}